import{Y as re,d as b,h as H,c as Q,B as w,D as I,G as a,J as _,K as p,N as L,O,H as ee,m as e,S as M,n as ue,u as y,L as z,P as ce,Q as de,Z as fe,I as ge,q as me,F as pe,T as ve,M as he}from"./vue-D2m1R9Aj.js";import{U as ye,W as C,V as F,j as m,b as Ve,c as A,d as Se,i as B,k as G,e as Y,f as ke,a as ae,h as J,X as le,x as be,F as we,G as Ee,n as Pe,o as Ce,r as q,s as _e,t as $,I as Te,Y as $e,Z as Ie,v as Z,N as Ne,O as Me,w as W,y as De,$ as Ue}from"./index-D38hp9Xp.js";import{a as qe}from"./vuetify-CEiwRrJY.js";const te=re("searchEngine",()=>{const V=b([]),S=b([]);function n(){V.value.push({uniqueId:ye(),id:0,lastQuery:"",query:"",itemsPerPage:10,filters:{title:"",category:"all",plugin:"enabled"},results:[],timer:null})}function g(t){V.value=V.value.filter(k=>k.uniqueId!==t)}async function s(t){const k=await C.startSearch(t.query,t.filters.category,[t.filters.plugin]);t.id=k.id,t.results=[],t.lastQuery=t.query}async function f(t){const k=await C.getSearchResults(t.id,t.results.length);return t.results.push(...k.results),k.status}async function E(t){t.id&&t.id!==0&&await C.stopSearch(t.id),t.id=0}async function P(){S.value=await C.getSearchPlugins()}async function T(t){await C.installSearchPlugin([t])}async function h(t){await C.uninstallSearchPlugin([t])}async function c(t){await C.enableSearchPlugin([t.name],!t.enabled)}async function N(){await C.updateSearchPlugins()}return{searchData:V,searchPlugins:S,createNewTab:n,deleteTab:g,runNewSearch:s,refreshResults:f,stopSearch:E,fetchSearchPlugins:P,installSearchPlugin:T,uninstallSearchPlugin:h,toggleSearchPlugin:c,updatePlugins:N,$reset:()=>{V.value=[],S.value=[],n()}}},{persistence:{enabled:!0,storageItems:[{storage:sessionStorage}]}}),Be={key:1,"data-testid":"mixedbtn-text"},X=H({__name:"MixedButton",props:{mobileOverride:{type:Boolean,default:!1},mobileValue:{type:Boolean},position:{},icon:{},text:{}},setup(V){const S=V,{mobile:n}=qe(),g=Q(()=>S.mobileOverride?S.mobileValue:n.value);return(s,f)=>(w(),I(m,{icon:g.value},{default:a(()=>[g.value||s.position==="left"?(w(),I(F,{key:0,"data-testid":"mixedbtn-icon-left"},{default:a(()=>[_(p(s.icon),1)]),_:1})):L("",!0),g.value?L("",!0):(w(),O("span",Be,p(s.text),1)),!g.value&&s.position==="right"?(w(),I(F,{key:2,"data-testid":"mixedbtn-icon-right"},{default:a(()=>[_(p(s.icon),1)]),_:1})):L("",!0)]),_:1},8,["icon"]))}}),Re=["href","title"],xe=H({__name:"PluginManagerDialog",props:{guid:{}},setup(V){const S=V,{isOpened:n}=Ve(S.guid),{t:g}=ee(),s=te(),f=[{title:g("dialogs.pluginManager.headers.enabled"),key:"enabled",sortable:!1},{title:g("dialogs.pluginManager.headers.name"),key:"fullName"},{title:g("dialogs.pluginManager.headers.version"),key:"version"},{title:g("dialogs.pluginManager.headers.url"),key:"url"},{title:g("dialogs.pluginManager.headers.actions"),key:"actions"}],E=b(!1),P=b(!1),T=b(!1),h=b(!1),c=b("");async function N(d){await s.toggleSearchPlugin(d),await s.fetchSearchPlugins()}async function t(){P.value=!0,await s.updatePlugins().then(()=>new Promise(d=>setTimeout(d,2e3))),await s.fetchSearchPlugins(),P.value=!1}async function k(){D(),E.value=!0,await s.installSearchPlugin(c.value),c.value="",setTimeout(()=>{s.fetchSearchPlugins().then(()=>{E.value=!1})},1e3)}async function r(d){E.value=!0,await s.uninstallSearchPlugin(d.name),await s.fetchSearchPlugins(),E.value=!1}const R=()=>{n.value=!1};function D(){T.value=!1}return(d,v)=>(w(),I(G,{modelValue:y(n),"onUpdate:modelValue":v[4]||(v[4]=i=>ce(n)?n.value=i:null)},{default:a(()=>[e(A,null,{default:a(()=>[e(Se,{class:"d-flex"},{default:a(()=>[M("div",null,p(d.$t("dialogs.pluginManager.title")),1),e(B),e(X,{icon:"mdi-update",text:d.$t("dialogs.pluginManager.update"),color:"accent",class:"mr-2",loading:P.value,onClick:t},null,8,["text","loading"]),e(G,{modelValue:T.value,"onUpdate:modelValue":v[3]||(v[3]=i=>T.value=i)},{activator:a(({props:i})=>[e(X,ue({icon:"mdi-toy-brick-plus",text:d.$t("dialogs.pluginManager.install.activator")},i,{color:"primary"}),null,16,["text"])]),default:a(()=>[e(A,{title:d.$t("dialogs.pluginManager.install.title")},{default:a(()=>[e(Y,null,{default:a(()=>[e(y(ke),{modelValue:h.value,"onUpdate:modelValue":v[1]||(v[1]=i=>h.value=i),onSubmit:v[2]||(v[2]=z(()=>{},["prevent"]))},{default:a(()=>[e(ae,{modelValue:c.value,"onUpdate:modelValue":v[0]||(v[0]=i=>c.value=i),autofocus:"",label:d.$t("dialogs.pluginManager.install.label")},null,8,["modelValue","label"])]),_:1},8,["modelValue"])]),_:1}),e(J,null,{default:a(()=>[e(B),e(m,{color:"error",onClick:D},{default:a(()=>[_(p(d.$t("common.cancel")),1)]),_:1}),e(m,{color:"accent",onClick:k},{default:a(()=>[_(p(d.$t("common.ok")),1)]),_:1})]),_:1})]),_:1},8,["title"])]),_:1},8,["modelValue"])]),_:1}),e(Y,null,{default:a(()=>[e(le,{mobile:null,headers:f,"items-per-page":"-1",items:y(s).searchPlugins,"sort-by":[{key:"fullName",order:"asc"}],loading:E.value},{"item.enabled":a(({item:i})=>[e(be,{"model-value":i.enabled,onClick:U=>N(i)},null,8,["model-value","onClick"])]),"item.url":a(({item:i})=>[M("a",{href:i.url,title:i.name},p(i.url),9,Re)]),"item.actions":a(({item:i})=>[e(F,{color:"red",icon:"mdi-delete",onClick:U=>r(i)},null,8,["onClick"])]),_:2},1032,["items","loading"])]),_:1}),e(J,null,{default:a(()=>[e(B),e(m,{color:"accent",onClick:R},{default:a(()=>[_(p(d.$t("common.close")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),Le={class:"pa-3"},Qe={style:{"font-size":"1.6em !important"},class:"subtitle-1 ml-2"},Oe={class:"d-flex justify-end"},Ke=H({__name:"SearchEngine",setup(V){const S=de(),{t:n}=ee(),g=we(),s=Ee(),f=te(),E=Pe(),P=b(),T=b(!1),h=b(0),{searchData:c}=fe(f),N=[{title:n("searchEngine.headers.fileName"),key:"fileName"},{title:n("searchEngine.headers.fileSize"),key:"fileSize"},{title:n("searchEngine.headers.nbSeeders"),key:"nbSeeders"},{title:n("searchEngine.headers.nbLeechers"),key:"nbLeechers"},{title:n("searchEngine.headers.siteUrl"),key:"siteUrl"},{title:"",key:"actions",sortable:!1}],t=[{title:n("searchEngine.filters.category.movies"),value:"movies"},{title:n("searchEngine.filters.category.tv"),value:"tv"},{title:n("searchEngine.filters.category.music"),value:"music"},{title:n("searchEngine.filters.category.games"),value:"games"},{title:n("searchEngine.filters.category.anime"),value:"anime"},{title:n("searchEngine.filters.category.software"),value:"software"},{title:n("searchEngine.filters.category.pictures"),value:"pictures"},{title:n("searchEngine.filters.category.books"),value:"books"}].sort((l,u)=>l.title.localeCompare(u.title)).splice(0,0,{title:n("searchEngine.filters.category.all"),value:"all"}),k=Q(()=>{const l=[{title:n("searchEngine.filters.plugins.all"),value:"all"},{title:n("searchEngine.filters.plugins.enabled"),value:"enabled"}];return f.searchPlugins.filter(u=>u.enabled).forEach(u=>{l.push({title:u.name,value:u.name})}),l}),r=Q(()=>c.value[h.value]??{}),{results:R}=Ce(()=>r.value.results,()=>r.value.filters?.title,l=>l.fileName);function D(){f.createNewTab(),h.value=c.value.length-1,P.value?.focus()}function d(){c.value.length!==1&&(f.deleteTab(r.value.uniqueId),h.value=Math.min(h.value,c.value.length-1))}function v(l){g.pushTorrentToQueue(l.fileUrl)}function i(l){window.open(l.descrLink,"_blank","noreferrer")}async function U(){await f.runNewSearch(r.value),r.value.timer=setInterval(()=>se(r.value),1e3),P.value?.saveValueToHistory()}async function x(l){await f.stopSearch(l),l.timer&&clearInterval(l.timer)}function ne(){c.value.forEach(x)}async function se(l){await f.refreshResults(l)==="Stopped"&&await x(l)}const K=()=>{S.push({name:"dashboard"})};function ie(){s.createDialog(xe)}function j(l){if(s.hasActiveDialog||T.value)return!1;l.key==="Escape"&&K()}return ge(async()=>{document.addEventListener("keydown",j),c.value.length===0?f.createNewTab():c.value.forEach(l=>{l.id&&l.id!==0&&(l.timer=setInterval(()=>f.refreshResults(l),1e3))}),await f.fetchSearchPlugins()}),me(()=>{document.removeEventListener("keydown",j),c.value.forEach(l=>{l.timer&&clearInterval(l.timer)})}),(l,u)=>(w(),O("div",Le,[e(q,{"no-gutters":"",align:"center",justify:"center"},{default:a(()=>[e($,null,{default:a(()=>[M("h1",Qe,p(y(n)("searchEngine.title")),1)]),_:1}),e($,null,{default:a(()=>[M("div",Oe,[e(m,{icon:"mdi-stop",variant:"plain",color:"error",onClick:ne}),e(m,{icon:"mdi-toy-brick",variant:"plain",color:"primary",onClick:ie}),e(m,{icon:"mdi-close",variant:"plain",onClick:K})])]),_:1})]),_:1}),e(q,{class:"ma-0 pa-0"},{default:a(()=>[e(Te,{class:"d-flex align-center justify-center ma-0 pa-0 bg-primary",fluid:""},{default:a(()=>[e($e,{modelValue:h.value,"onUpdate:modelValue":u[0]||(u[0]=o=>h.value=o),class:"overflow-auto","bg-color":"primary","show-arrows":""},{default:a(()=>[(w(!0),O(pe,null,ve(y(c),o=>(w(),I(Ie,{key:o.uniqueId},{default:a(()=>[M("h4",null,p(!o.lastQuery||o.lastQuery.length===0?l.$t("searchEngine.tabHeaderEmpty"):o.lastQuery),1)]),_:2},1024))),128))]),_:1},8,["modelValue"]),e(B),e(m,{icon:"mdi-plus-circle-outline",variant:"plain",color:"accent",onClick:D}),e(m,{icon:"mdi-minus-circle-outline",variant:"plain",color:"error",disabled:y(c).length===1,onClick:d},null,8,["disabled"])]),_:1})]),_:1}),e(_e,null,{default:a(()=>[e(Z,null,{default:a(()=>[e(q,{class:"mt-1"},{default:a(()=>[e($,{cols:"12",md:"6"},{default:a(()=>[e(Ne,{modelValue:r.value.query,"onUpdate:modelValue":u[1]||(u[1]=o=>r.value.query=o),"history-key":y(Me).SEARCH_ENGINE_QUERY,ref_key:"queryInput",ref:P,autofocus:"",density:"compact","hide-details":"",clearable:"",label:l.$t("searchEngine.query"),onKeydown:he(z(U,["prevent"]),["enter"])},null,8,["modelValue","history-key","label","onKeydown"])]),_:1}),e($,{cols:"6",sm:"5",md:"2"},{default:a(()=>[e(W,{modelValue:r.value.filters.category,"onUpdate:modelValue":u[2]||(u[2]=o=>r.value.filters.category=o),height:"1",variant:"outlined",density:"compact","hide-details":"",items:y(t),label:l.$t("searchEngine.filters.category.label")},null,8,["modelValue","items","label"])]),_:1}),e($,{cols:"6",sm:"5",md:"2"},{default:a(()=>[e(W,{modelValue:r.value.filters.plugin,"onUpdate:modelValue":u[3]||(u[3]=o=>r.value.filters.plugin=o),flat:"",density:"compact","hide-details":"",variant:"outlined",items:k.value,label:l.$t("searchEngine.filters.plugins.label")},null,8,["modelValue","items","label"])]),_:1}),e($,{cols:"12",sm:"2",class:"d-flex align-center justify-center"},{default:a(()=>[r.value.id===0?(w(),I(m,{key:0,color:"accent",flat:"",class:"mx-auto px-4",onClick:U},{default:a(()=>[_(p(l.$t("searchEngine.runSearch")),1)]),_:1})):(w(),I(m,{key:1,color:"warning",flat:"",class:"mx-auto px-4",onClick:u[4]||(u[4]=o=>x(r.value))},{default:a(()=>[_(p(l.$t("searchEngine.stopSearch")),1)]),_:1}))]),_:1})]),_:1})]),_:1}),e(De,{class:"my-3"}),e(Z,{class:"text-select"},{default:a(()=>[e(le,{mobile:null,headers:N,items:y(R),"footer-props":{itemsPerPageOptions:[10,25,50,100,-1]},"items-per-page":r.value.itemsPerPage},{top:a(()=>[e(q,null,{default:a(()=>[e($,{cols:"12"},{default:a(()=>[e(ae,{modelValue:r.value.filters.title,"onUpdate:modelValue":u[5]||(u[5]=o=>r.value.filters.title=o),density:"compact","hide-details":"",label:l.$t("searchEngine.filters.title.label")},null,8,["modelValue","label"])]),_:1})]),_:1})]),"item.fileSize":a(({item:o})=>[_(p(y(Ue)(o.fileSize,y(E).useBinarySize)),1)]),"item.actions":a(({item:o})=>[e(m,{icon:"mdi-open-in-new",variant:"flat",density:"compact",onClick:z(oe=>i(o),["stop"])},null,8,["onClick"]),e(m,{icon:"mdi-download",variant:"flat",density:"compact",onClick:oe=>v(o)},null,8,["onClick"])]),_:2},1032,["items","items-per-page"])]),_:1})]),_:1})]))}});export{Ke as default};
